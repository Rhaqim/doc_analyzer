<!DOCTYPE html>
<html>
	<head>
		<title>Doc Analyzer</title>
		<style>
			body {
				background-color: #000;
				color: #fff;
				font-family: Arial, sans-serif;
			}
			.header {
				text-align: center;
				padding: 20px;
				font-size: 24px;
				font-weight: bold;
			}
			.tabs {
				display: flex;
				justify-content: center;
				margin-top: 50px;
			}
			.tab {
				padding: 10px 20px;
				cursor: pointer;
				border: 2px solid #fff;
				border-radius: 8px;
				margin: 0 10px;
			}
			.tab.active {
				background-color: #fff;
				color: #000;
			}
			.content {
				display: none;
				text-align: center;
				margin-top: 30px;
			}
			.content.active {
				display: block;
			}
		</style>
	</head>
	<body>
		<div class="header">Doc Analyzer</div>
		<div class="tabs">
			<div class="tab active" onclick="showTab('train')">Train</div>
			<div class="tab" onclick="showTab('upload')">Upload</div>
		</div>
		<div class="content active" id="train-content">
			<!-- Add content for the Train tab here -->
			<p>Select documents to train with:</p>
			<div id="document-list">
				<!-- Document list will be populated here dynamically -->
			</div>
			<button id="train-btn" onclick="trainDocuments()" style="display: none">
				Train
			</button>
		</div>
		<div class="content" id="upload-content">
			<!-- Add content for the Upload tab here -->
			<p>Content for the Upload tab goes here.</p>
		</div>

		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script>
			function showTab(tabName) {
				var tabs = document.querySelectorAll(".tab");
				for (var i = 0; i < tabs.length; i++) {
					tabs[i].classList.remove("active");
				}

				var contents = document.querySelectorAll(".content");
				for (var i = 0; i < contents.length; i++) {
					contents[i].classList.remove("active");
				}

				var tab = document.getElementById(tabName + "-content");
				var correspondingTab = document.querySelector(
					`[onclick*="${tabName}"]`
				);

				tab.classList.add("active");
				correspondingTab.classList.add("active");
			}

			// Flag to track whether the document list has been populated
			let isDocumentListPopulated = false;

			// Function to fetch documents and populate the document list
			function populateDocumentList() {
				if (isDocumentListPopulated) {
					return; // Skip population if already done
				}

				fetch("/get_documents")
					.then(response => response.json())
					.then(data => {
						console.log("Documents:", data.documents);
						const documentList = document.getElementById("document-list");

						let documentListHTML = ""; // Initialize the string to store HTML content

						if (data.documents.length > 0) {
							data.documents.forEach(document => {
								documentListHTML += `
                                <input type="checkbox" name="document" value="${document.id}" onclick="checkTrainButton()">
                                <label>${document.name}</label><br>
                            `;
							});
							documentList.innerHTML = documentListHTML; // Set the HTML content all at once

							// Check if the train button should be shown
							checkTrainButton();
							isDocumentListPopulated = true; // Set the flag to true after successful population
						} else {
							documentList.innerHTML = "<p>No documents available.</p>";
							document.getElementById("train-btn").style.display = "none";
						}
					})
					.catch(error => {
						console.error("Error fetching documents:", error);
					});
			}

			// Function to check if the train button should be shown
			function checkTrainButton() {
				const checkedDocuments = document.querySelectorAll(
					"input[name=document]:checked"
				);
				const trainButton = document.getElementById("train-btn");
				if (checkedDocuments.length > 1) {
					trainButton.style.display = "block";
				} else {
					trainButton.style.display = "none";
				}
			}

			// Function to trigger the training process
			function trainDocuments() {
				const checkedDocuments = document.querySelectorAll(
					"input[name=document]:checked"
				);
				const selectedDocuments = [];
				checkedDocuments.forEach(doc => {
					selectedDocuments.push(doc.value);
				});
				// You can implement an API call here to send the selectedDocuments to the Flask backend for further processing
				console.log("Selected Documents:", selectedDocuments);
			}

			// Fetch the documents when the page loads
			document.addEventListener("DOMContentLoaded", () => {
				populateDocumentList();
			});
		</script>
	</body>
</html>
